{
    "global" : {
        "confirm_prompt" : false,
        "log_dir" : "log/",
        "cfg_dir" : "/etc/taos/",
        "host": "192.168.1.1",
        "port": 6030,
        "user": "root",
        "password": "taosdata"
    },
    "job_concurrency" : 3,
    "jobs" : [
        {
            "job_type" : "insert",
            "job_name" : "insert-second",
            "dependencies" : [],
            "source" : {
                "source_type" : "csv",
                "columns" : {
                    "file_path" : "/root/data/cnnc_csv_1s/",
                    "has_header" : true
                },
                "tags" : {
                    "file_path" : "/root/meta/cnnc_csv_1s.csv",
                    "has_header" : true
                },
                "timestamp_strategy": {
                    "strategy_type": "original",
                    "original_config": {
                        "column_index": 0,
                        "precision": "us"
                    }
                }
            },
            "target" : {
                "general" : {
                    "timestamp_precision" : "us",
                    "child_table_prefix" : "s",
                    "child_table_count" : 10000,
                    "insert_rows_per_table" : 10000,
                    "use_source_definition": false,
                    "columns" : [
                        {"name" : "latitude", "type" : "float"},
                        {"name" : "longitude", "type" : "float"},
                        {"name" : "quality", "type" : "varchar", "len" : 50}
                    ],
                    "tags" : [
                        {"name" : "type", "type" : "varchar", "len" : 7},
                        {"name" : "name", "type" : "varchar", "len" : 20},
                        {"name" : "department", "type" : "varchar", "len" : 7}
                    ]
                },
                "target_type"    : "tdengine",
                "tdengine" : {
                    "database_info" : {
                        "name" : "testdb",
                        "drop_if_exists" : true,
                        "vgroups" : 20,
                        "replica" : 3,
                        "keep" : 3650
                    },
                    "table_info" : {
                        "name" : "points",
                        "super_table_exists" : false,
                        "child_table_exists" : false,
                        "auto_create_table" : false,
                        "create_table_threads" : 10,
                        "create_tables_per_batch" : 1000,
                        "preload_table_meta" : true
                    }
                }
            },
            "control"   : {
                "data_format" : {
                    "format_type" : "sql"
                },
                "data_channel" : {
                    "channel_type" : "native"
                },
                "data_generation" : {
                    "interlace_mode": {
                        "enabled": true,
                        "interlace_rows": 60
                    },
                    "generate_threads" : 8
                },
                "insert_control" : {
                    "rows_per_request" : 10000,
                    "insert_threads": 8,
                    "thread_allocation": "vgroup_binding"
                },
                "time_interval" : {
                    "enabled": true,
                    "interval_strategy": "first_to_first"
                }
            }
        },
        {
            "job_type" : "insert",
            "job_name" : "insert-minute",
            "dependencies" : ["insert-1.create_super_table"], 
            "source" : {
                "source_type" : "csv",
                "columns" : {
                    "file_path" : "/root/data/cnnc_csv_1m/",
                    "has_header" : true
                },
                "tags" : {
                    "file_path" : "/root/meta/cnnc_csv_1m.csv",
                    "has_header" : true
                },
                "timestamp_strategy": {
                    "strategy_type": "original",
                    "original_config": {
                        "column_index": 0,
                        "precision": "ms"
                    }
                }
            },
            "target" : {
                "general" : {
                    "timestamp_precision" : "us",
                    "child_table_prefix" : "m",
                    "child_table_count" : 10000,
                    "insert_rows_per_table" : 10000,
                    "use_source_definition": false,
                    "columns" : [
                        {"name" : "latitude", "type" : "float"},
                        {"name" : "longitude", "type" : "float"},
                        {"name" : "quality", "type" : "varchar", "len" : 50}
                    ],
                    "tags" : [
                        {"name" : "type", "type" : "varchar", "len" : 7},
                        {"name" : "name", "type" : "varchar", "len" : 20},
                        {"name" : "department", "type" : "varchar", "len" : 7}
                    ]
                },
                "target_type"    : "tdengine",
                "tdengine" : {
                    "database_info" : {
                        "name" : "testdb",
                        "drop_if_exists" : false
                    },
                    "table_info" : {
                        "name" : "points",
                        "super_table_exists" : true,
                        "child_table_exists" : false,
                        "auto_create_table" : false,
                        "create_table_threads" : 10,
                        "create_tables_per_batch" : 1000,
                        "preload_table_meta" : true
                    }
                }
            },
            "control"   : {
                "data_format" : {
                    "format_type" : "sql"
                },
                "data_channel" : {
                    "channel_type" : "native"
                },
                "data_generation" : {
                    "interlace_mode": {
                        "enabled": true,
                        "interlace_rows": 1
                    },
                    "generate_threads" : 8
                },
                "insert_control" : {
                    "rows_per_request" : 10000,
                    "insert_threads": 8,
                    "thread_allocation": "vgroup_binding"
                },
                "time_interval" : {
                    "enabled": true,
                    "interval_strategy": "first_to_first"
                }
            }
        },
        {
            "job_type" : "query",
            "job_name" : "query-1",
            "dependencies" : [
                "insert-second.create_child_table",
                "insert-minute.create_child_table"
            ],
            "control"   : {
                "data_format" : {
                    "format_type" : "sql"
                },
                "data_channel" : {
                    "channel_type" : "native"
                },
                "query_control": {
                    "execution" : {
                        "mode": "parallel_per_group",
                        "threads": 10,
                        "times": 50,
                        "interval": 100
                    },
                    "query_type" : "super_table",

                    "super_table": {
                        "database_name" : "testdb",
                        "super_table_name" : "points",
                        "placeholder": "${child_table}",
                        "templates": [
                            {
                                "sql_template": "select count(*) from ${child_table}",
                                "output_file": "stb_result.txt" 
                            }
                        ]
                    }
                }
            }
        }
    ]
}
