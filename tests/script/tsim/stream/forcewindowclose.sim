system sh/stop_dnodes.sh
system sh/deploy.sh -n dnode1 -i 1
system sh/exec.sh -n dnode1 -s start
sleep 50
sql connect

print ========================================== create database
sql create database test vgroups 2;
sql select * from information_schema.ins_databases
if $rows != 3 then
  return -1
endi

print $data00 $data01 $data02

sql use test
sql create stable st(ts timestamp, a int) tags(t int);
sql create table tu1 using st tags(1);

sql_error create stream stream1 trigger force_window_close into str_dst as select  _wstart, count(*) from st partition by tbname interval(5s) sliding(6s);
sql_error create stream stream1 trigger force_window_close into str_dst as select  _wstart, count(*) from st partition by tbname interval(5s) sliding(9a);
sql_error create stream stream1 trigger force_window_close into str_dst as select  _wstart, count(*) from st partition by tbname interval(5s) sliding(1.1s);
sql create stream stream1 trigger force_window_close into str_dst as select  _wstart, _wend, count(*) from st partition by tbname interval(5s) sliding(1s);
run tsim/stream/checkTaskStatus.sim

sql insert into tu1 values(now, 1);
sleep 5500

$loop_count = 0

loop1:
sleep 500
$loop_count = $loop_count + 1
if $loop_count == 20 then
  goto end_loop1
endi

sql insert into tu1 values(now, 1);
goto loop1

end_loop1:

sleep 5000

sql select sum(`count(*)`) from (select * from str_dst)

if $data00 != 185 then
  print expect 185, actual: $data00
  return -1
endi

sleep 1000000

system sh/exec.sh -n dnode1 -s stop -x SIGINT
